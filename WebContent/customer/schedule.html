<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>汉唐剧院管理系统-放映安排</title>
    <link rel="stylesheet" href="../css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../css/slick.css"/>
    <link rel="stylesheet" href="../css/slicknav.css"/>
    <link rel="stylesheet" href="../css/animate.css"/>
    <link rel="stylesheet" href="../css/bootstrap.css"/>
    <link rel="stylesheet" href="../css/theme.css"/>
    <script type="text/javascript">
        UrlParm = function () { // url参数
            var data, index;
            (function init() {
                data = [];
                index = {};
                var u = window.location.search.substr(1);
                if (u != '') {
                    var parms = decodeURIComponent(u).split('&');
                    for (var i = 0, len = parms.length; i < len; i++) {
                        if (parms[i] != '') {
                            var p = parms[i].split("=");
                            if (p.length == 1 || (p.length == 2 && p[1] == '')) {// p | p=
                                data.push(['']);
                                index[p[0]] = data.length - 1;
                            } else if (typeof (p[0]) == 'undefined' || p[0] == '') { // =c | =
                                data[0] = [p[1]];
                            } else if (typeof (index[p[0]]) == 'undefined') { // c=aaa
                                data.push([p[1]]);
                                index[p[0]] = data.length - 1;
                            } else {// c=aaa
                                data[index[p[0]]].push(p[1]);
                            }
                        }
                    }
                }
            })();
            return {
                // 获得参数
                parm: function (o) { // o: 参数名或者参数次序
                    try {
                        return (typeof (o) == 'number' ? data[o][0] : data[index[o]][0]);
                    } catch (e) {
                    }
                },
                //获得参数组, 类似request.getParameterValues()
                parmValues: function (o) { //  o: 参数名或者参数次序
                    try {
                        return (typeof (o) == 'number' ? data[o] : data[index[o]]);
                    } catch (e) {
                    }
                },
                //是否含有parmName参数
                hasParm: function (parmName) {
                    return typeof (parmName) == 'string' ? typeof (index[parmName]) != 'undefined' : false;
                },
                // 获得参数Map ,类似request.getParameterMap()
                parmMap: function () {
                    var map = {};
                    try {
                        for (var p in index) {
                            map[p] = data[index[p]];
                        }
                    } catch (e) {
                    }
                    return map;
                }
            }
        }();

        function get_button_html(studio_id, sched_time, price) {
            var button_html = "<button type=\"button\" className=\"btn btn-sm btn-danger\"\n" +
                "onClick=\"javascript:window.location='seats.html?" +
                "name=" + UrlParm.parm("name") + "&studio_id=" + studio_id +
                "&sched_time=" + sched_time + "&price=" + price +
                "'\">选座购票\n" +
                "</button>";
            return button_html;
        }

        function search() {
            var url = "/ScheduleServlet";
            if (window.XMLHttpRequest)
                req = new XMLHttpRequest();
            else if (window.ActiveXObject)
                req = new ActiveXObject("Microsoft.XMLHTTP");
            if (req) {
                //采用POST方式，异步传输
                req.open("post", url, true);
                //POST方式，必须加入如下头信息设定
                req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                req.onreadystatechange = function () {
                    if (req.readyState == 4 && req.status == 200) {
                        var json = JSON.parse(req.responseText);
                        if (json.length == 0) {
                            alert("暂无演出计划，请选择其他剧目")
                        } else {
                            for (i = 0; i < json.length; i++) {
                                var theTable = document.getElementById("mytable");//table的id
                                var num = theTable.rows.length;
                                while (num > 1) {
                                    theTable.deleteRow(num - 1);
                                    num = theTable.rows.length;
                                }
                                var json = JSON.parse(req.responseText);//转换为json对象
                                for (i = 0; i < json.length; i++) {
                                    var rowCount = theTable.rows.length; //获得当前表格的行数
                                    var row = theTable.insertRow(rowCount);//在tale里动态的增加tr
                                    row.insertCell(0).innerHTML = json[i].sched_time;
                                    row.insertCell(1).innerHTML = UrlParm.parm("language");
                                    row.insertCell(2).innerHTML = json[i].studio_id;
                                    row.insertCell(3).innerHTML = json[i].sched_ticket_price;
                                    row.insertCell(4).innerHTML = get_button_html(json[i].studio_id, json[i].sched_time, json[i].sched_ticket_price);
                                }
                            }
                        }
                    }
                }
                req.send("type=search&play_id=" + UrlParm.parm("id"));
            }
        }

        function init() {
            document.getElementById("image").src = "../images/property/" + UrlParm.parm("image");
            document.getElementById("play_name").innerHTML = UrlParm.parm("name");
            document.getElementById("play_type").innerHTML = UrlParm.parm("play_type");
            document.getElementById("language").innerHTML = UrlParm.parm("language");
            document.getElementById("length").innerHTML = UrlParm.parm("length") + "分钟";
            document.getElementById("introduction").innerHTML = UrlParm.parm("introduction");
            search();
        }
    </script>
</head>
<body class="contact-template" onload="init()">
<header id="site-header">
    <div class="container">
        <div class="row">
            <div class="col-md-2" style="margin:5px">
                <a href="index.html"><img src="../images/logo.png" width="127" height="48"/></a>
            </div>
            <div class="col-md-5 col-sm-8">
                <nav id="site-nav" class="nav navbar-default">
                    <ul class="nav navbar-nav">
                        <li><a href="index.html">主页</a></li>
                        <li><a href="board.html">榜单</a></li>
                        <li><a href="contact.html">联系我们</a></li>
                        <li><a href="login.html">登陆</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</header>

<div class="main-page clearfix" style="width:100%;background-image:url('../images/banner_bg.png');">
    <div class="container" style="margin-top: 15px;margin-bottom:15px">
        <div class="row">
            <div class="col-md-3">
                <div class="contact-form-wrapper">
                    <img src="#" width="232px" height="322px" id="image">
                </div>
            </div>
            <div class="col-md-3" style="color:white">
                <h3 style="color:white" id="name"></h3><br>
                <p id="play_name"></p>
                <p id="play_type"></p>
                <p id="language"></p>
                <p id="length"></p>
                <button type="button" class="btn btn-warning"><i class="fa fa-heart-o"></i> 想看</button>
                <button type="button" class="btn btn-warning"><i class="fa fa-star-o"></i> 评分</button>
                <br><br>
                <button type="button" class="btn btn-danger" style="width:150px" onclick="alert('很遗憾，特惠票已售罄!')">特惠购票
                </button>
            </div>
            <div class="col-md-4" style="color:white;"><br><br><br><br><br><br><br><br>
                <p id="introduction"></p>
            </div>
        </div>
    </div>
</div>

<div class="main-page clearfix">
    <div class="container" style="margin-top: 15px;margin-bottom:15px">
        <div class="row">
            <table class="table table-hover" id="mytable">
                <tr>
                    <td>放映时间
                    <td>
                    <td>语言版本
                    <td>
                    <td>放映厅
                    <td>
                    <td>售价
                    <td>
                    <td>选座购票
                    <td>
                <tr>
                <tr>
                    <!--                    <td>10:00&#45;&#45;12:00<td>-->
                    <!--                    <td>国语 2D<td>-->
                    <!--                    <td>VIP厅<td>-->
                    <!--                    <td>35.0<td>-->
                    <!--                    <td><button type="button" class="btn btn-sm btn-danger" onclick="javascript:window.location='seats.html?sched=1'">选座购票</button><td>-->
                    <!--                <tr>-->
            </table>
        </div>
    </div>
</div>

<a href="#top" id="scroll-top"><i class="fa fa-angle-up"></i></a>
<script src="../js/jquery.min.js"></script>
<script src="../js/jquery-ui.min.js"></script>
<script src="../js/jquery.form.min.js"></script>
<script src="../js/jquery.validate.min.js"></script>
<!--<script src="../js/theme.js"></script>-->
</body>
</html>
